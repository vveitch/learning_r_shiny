<!DOCTYPE html>
<!-- saved from url=(0042)http://shiny.rstudio.com/tutorial/lesson6/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Shiny - Use reactive expressions</title>
  <meta property="st:title" content="Use reactive expressions">
  <link rel="stylesheet" type="text/css" href="./Shiny - Use reactive expressions_files/bootstrap.min.css">
  <script type="text/javascript" async="" src="http://s.swiftypecdn.com/cc.js"></script><script type="text/javascript" async="" src="./Shiny - Use reactive expressions_files/swiftype_nocode-1e2450bb2c8ab71c76799ca74494b5c6.js"></script><script type="text/javascript" async="" src="./Shiny - Use reactive expressions_files/embed.js"></script><script async="" src="http://www.google-analytics.com/analytics.js"></script><script src="./Shiny - Use reactive expressions_files/highlight.min.js"></script>
  <script src="./Shiny - Use reactive expressions_files/jquery-1.10.2.min.js"></script>
  <script src="./Shiny - Use reactive expressions_files/bootstrap.min.js"></script>
  <link href="./Shiny - Use reactive expressions_files/css" rel="stylesheet" type="text/css">
  <link href="./Shiny - Use reactive expressions_files/css(1)" rel="stylesheet" type="text/css">
  <link href="./Shiny - Use reactive expressions_files/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" type="text/css" href="./Shiny - Use reactive expressions_files/global.css">
  <script src="./Shiny - Use reactive expressions_files/respond.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-20375833-9', 'rstudio.com');
    ga('require', 'linkid', 'linkid.js');
    ga('send', 'pageview');
  </script>
<link rel="stylesheet" type="text/css" href="./Shiny - Use reactive expressions_files/swiftype_nocode-862cc0feac61f00e170fbcc6360aeeb7.css"><script type="text/javascript" async="" src="./Shiny - Use reactive expressions_files/embed(1).js"></script></head>
<body>
  <div class="header">
  <div class="container brand">
    <div class="search pull-right">
      <form>
        <input id="st-search-input" type="text" class="form-control input-sm" placeholder="Search" autocomplete="off" autocorrect="off" autocapitalize="off" style="outline: none;">
<script type="text/javascript">
  var Swiftype = window.Swiftype || {};
    (function() {
      Swiftype.key = 'PeTiSRv94X52JCzFyMzF';
      Swiftype.disableAutocomplete = true;        
      /** DO NOT EDIT BELOW THIS LINE **/
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = "//swiftype.com/embed.js";
      var entry = document.getElementsByTagName('script')[0];
      document.getElementsByTagName('script')[0].parentNode.insertBefore(script, entry);
    }());
</script>

      </form>
    </div>
    <a href="http://shiny.rstudio.com/">Shiny</a>
    <span id="credits">by <a href="http://www.rstudio.com/">RStudio</a></span>
  </div>
</div>
<div class="container content">
  <div class="row">
    <div class="col-md-2 col-sm-12">
      <div class="nav nav-primary punchup">
        <ul class="list-unstyled">
          <li><a href="http://shiny.rstudio.com/">Overview</a></li>
          <li class="active"><a href="http://shiny.rstudio.com/tutorial/">Tutorial</a></li>
          <li><a href="http://shiny.rstudio.com/articles/">Articles</a></li>
          <li><a href="http://shiny.rstudio.com/gallery/">Gallery</a></li>
          <li><a href="http://shiny.rstudio.com/reference/shiny/latest">Reference</a></li>
          <li><a href="http://shiny.rstudio.com/deploy/">Deploy</a></li>
          <li><a href="http://shiny.rstudio.com/help/">Help</a></li>
        </ul>
      </div>
    </div>
    
<script>
$(document).on("click", ".answer-toggle", function(e) {
  $(this).parent(".answer").find(".answer-content").fadeIn();
  $(this).hide();
  e.preventDefault();
});
</script>

<div class="col-md-8 col-sm-12 tutorial constrain-image-width">
  <ul class="pagination">
    
    <li><a href="http://shiny.rstudio.com/tutorial/lesson5"><i class="fa fa-chevron-left"></i></a></li>
    

    
    <li><a href="http://shiny.rstudio.com/tutorial/lesson1">1</a></li>
    
    <li><a href="http://shiny.rstudio.com/tutorial/lesson2">2</a></li>
    
    <li><a href="http://shiny.rstudio.com/tutorial/lesson3">3</a></li>
    
    <li><a href="http://shiny.rstudio.com/tutorial/lesson4">4</a></li>
    
    <li><a href="http://shiny.rstudio.com/tutorial/lesson5">5</a></li>
    
    <li class="active"><a href="http://shiny.rstudio.com/tutorial/lesson6">Lesson 6</a></li>
    
    <li><a href="http://shiny.rstudio.com/tutorial/lesson7">7</a></li>
    

    
    <li><a href="http://shiny.rstudio.com/tutorial/lesson7"><i class="fa fa-chevron-right"></i></a></li>
    
  </ul>

  <h1>
    <small class="tutorial-lesson-number punchup">Lesson 6</small><br>
    Use reactive expressions
  </h1>
  <p>Shiny apps wow your users by running fast, instantly fast. But what if your app needs to do a lot of slow computation?</p>

<p>This lesson will show you how to streamline your Shiny apps with reactive expressions. Reactive expressions let you control which parts of your app update when, which prevents unnecessary work.</p>

<p>To get started:</p>

<ul>
  <li>Create a new folder named <code>stockVis</code> in your working directory. </li>
  <li>Download the following files and place them inside <code>stockVis</code>: <a href="http://shiny.rstudio.com/tutorial/lesson6/stockVis/ui.R">ui.R</a>, <a href="http://shiny.rstudio.com/tutorial/lesson6/stockVis/server.R">server.R</a>, and <a href="http://shiny.rstudio.com/tutorial/lesson6/stockVis/helpers.R">helpers.R</a>.</li>
  <li>Launch the app with <code>runApp("stockVis")</code></li>
</ul>

<p>StockVis use R’s <code>quantmod</code> package, so you’ll need to install <code>quantmod</code> with <code>install.packages("quantmod")</code> if you do not already have it. </p>

<div class="highlight"><pre><code class="r"><span class="identifier">runApp</span><span class="p"><span class="paren">(</span></span><span class="s"><span class="string">"stockVis"</span></span><span class="p"><span class="paren">)</span></span>
</code></pre></div>

<h2 id="a-new-app-stockvis">A new app: stockVis</h2>
<p>The stockVis app looks up stock prices by ticker symbol and displays the results as a line chart. The app lets you</p>

<ol>
  <li>Select a stock to examine</li>
  <li>Pick a range of dates to review</li>
  <li>Choose whether to plot stock prices or the log of the stock prices on the y axis, and </li>
  <li>Decide whether or not to correct prices for inflation.</li>
</ol>

<p><img src="./Shiny - Use reactive expressions_files/stockVis1.png" alt=""></p>

<p>Note that the “Adjust prices for inflation” check box doesn’t work yet. One of our tasks in this lesson is to fix this check box.</p>

<p>By default, stockVis displays the SPY ticker (an index of the entire S &amp; P 500). To look up a different stock, type in a stock symbol that Yahoo finance will recognize. You can find a list of Yahoo’s stock symbols <a href="http://finance.yahoo.com/lookup">here</a>. Some common symbols are GOOG (Google), AAPL (Apple), and GS (Goldman Sachs).</p>

<p>StockVis relies heavily on two functions from the <code>quantmod</code> package: </p>

<ol>
  <li>It uses<code>getSymbols</code> to download financial data straight into R from websites like <a href="http://finance.yahoo.com/">Yahoo finance</a> and the <a href="http://research.stlouisfed.org/fred2/">Federal Reserve Bank of St. Louis</a>. </li>
  <li>It uses <code>chartSeries</code> to display prices in an attractive chart. </li>
</ol>

<p>StockVis also relies on an R script named <code>helpers.R</code>, which contains a function that adjusts stock prices for inflation.</p>

<h3 id="check-boxes-and-date-ranges">Check boxes and date ranges</h3>

<p>The stockVis app uses a few new widgets.</p>

<ul>
  <li>a date range selector, created with <code>dateRangeInput</code>, and </li>
  <li>a couple of check boxes made with <code>checkboxInput</code>. Check box widgets are very simple. They return a <code>TRUE</code> when the check box is checked, and a <code>FALSE</code> when the check box is not checked. </li>
</ul>

<p>The check boxes are named <code>log</code> and <code>adjust</code> in the <code>ui.R</code> script, which means you can look them up as <code>input$log</code> and <code>input$adjust</code> in the <code>server.R</code> script. If you’d like to review how to use widgets and their values, check out <a href="http://shiny.rstudio.com/tutorial/Lesson-3/">Lesson 3</a> and <a href="http://shiny.rstudio.com/tutorial/Lesson-4/">Lesson 4</a>.</p>

<h2 id="streamline-computation">Streamline computation</h2>

<p>The stockVis app has a problem. </p>

<p>Examine what will happen when you click “Plot y axis on the log scale.” The value of <code>input$log</code> will change, which will cause the entire expression in <code>renderPlot</code> to re-run:</p>

<div class="highlight"><pre><code class="r"><span class="identifier">output</span><span class="o"><span class="operator">$</span></span><span class="identifier">plot</span> <span class="o"><span class="operator">&lt;-</span></span> <span class="identifier">renderPlot</span><span class="p"><span class="paren">(</span><span class="paren">{</span></span>
  <span class="identifier">data</span> <span class="o"><span class="operator">&lt;-</span></span> <span class="identifier">getSymbols</span><span class="p"><span class="paren">(</span></span><span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">symb</span><span class="p">,</span> <span class="identifier">src</span> <span class="o"><span class="operator">=</span></span> <span class="s"><span class="string">"yahoo"</span></span><span class="p">,</span> 
    <span class="identifier">from</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">dates</span><span class="p"><span class="paren">[</span></span><span class="m"><span class="number">1</span></span><span class="p"><span class="paren">]</span>,</span>
    <span class="identifier">to</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">dates</span><span class="p"><span class="paren">[</span></span><span class="m"><span class="number">2</span></span><span class="p"><span class="paren">]</span>,</span>
    <span class="identifier">auto.assign</span> <span class="o"><span class="operator">=</span></span> <span class="kc"><span class="literal">FALSE</span></span><span class="p"><span class="paren">)</span></span>
               
  <span class="identifier">chartSeries</span><span class="p"><span class="paren">(</span></span><span class="identifier">data</span><span class="p">,</span> <span class="identifier">theme</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">chartTheme</span><span class="p"><span class="paren">(</span></span><span class="s"><span class="string">"white"</span></span><span class="p"><span class="paren">)</span>,</span> 
    <span class="identifier">type</span> <span class="o"><span class="operator">=</span></span> <span class="s"><span class="string">"line"</span></span><span class="p">,</span> <span class="identifier">log.scale</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">log</span><span class="p">,</span> <span class="identifier">TA</span> <span class="o"><span class="operator">=</span></span> <span class="kc"><span class="literal">NULL</span></span><span class="p"><span class="paren">)</span></span>
<span class="p"><span class="paren">}</span><span class="paren">)</span></span>
</code></pre></div>

<p>Each time <code>renderPlot</code> re-runs</p>

<ol>
  <li>it re-fetches the data from Yahoo finance with <code>getSymbols</code>, and</li>
  <li>it re-draws the chart with the correct axis.</li>
</ol>

<p>This is not good, because you do not need to re-fetch the data to re-draw the plot. In fact, Yahoo finance will cut you off if you re-fetch your data too often (because you begin to look like a bot). But more importantly, re-running <code>getSymbols</code> is unnecessary work, which can slow down your app and consume server bandwidth. </p>

<h2 id="reactive-expressions">Reactive expressions</h2>

<p>You can limit what gets re-run during a reaction with reactive expressions. </p>

<p>A reactive expression is an R expression that uses widget input and returns a value. The reactive expression will update this value whenever the original widget changes. </p>

<p>To create a reactive expression use the <code>reactive</code> function, which takes an R expression surrounded by braces (just like the <code>render*</code> functions).</p>

<p>For example, here’s a reactive expression that uses the widgets of stockVis to fetch data from Yahoo.</p>

<div class="highlight"><pre><code class="r"><span class="identifier">dataInput</span> <span class="o"><span class="operator">&lt;-</span></span> <span class="identifier">reactive</span><span class="p"><span class="paren">(</span><span class="paren">{</span></span>
  <span class="identifier">getSymbols</span><span class="p"><span class="paren">(</span></span><span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">symb</span><span class="p">,</span> <span class="identifier">src</span> <span class="o"><span class="operator">=</span></span> <span class="s"><span class="string">"yahoo"</span></span><span class="p">,</span> 
    <span class="identifier">from</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">dates</span><span class="p"><span class="paren">[</span></span><span class="m"><span class="number">1</span></span><span class="p"><span class="paren">]</span>,</span>
    <span class="identifier">to</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">dates</span><span class="p"><span class="paren">[</span></span><span class="m"><span class="number">2</span></span><span class="p"><span class="paren">]</span>,</span>
    <span class="identifier">auto.assign</span> <span class="o"><span class="operator">=</span></span> <span class="kc"><span class="literal">FALSE</span></span><span class="p"><span class="paren">)</span></span>
<span class="p"><span class="paren">}</span><span class="paren">)</span></span>
</code></pre></div>

<p>When you run the expression, it will run <code>getSymbols</code> and return the results, a data frame of price data. You can use the expression to access price data in <code>renderPlot</code> by calling <code>dataInput()</code>.</p>

<div class="highlight"><pre><code class="r"><span class="identifier">output</span><span class="o"><span class="operator">$</span></span><span class="identifier">plot</span> <span class="o"><span class="operator">&lt;-</span></span> <span class="identifier">renderPlot</span><span class="p"><span class="paren">(</span><span class="paren">{</span></span>    
  <span class="identifier">chartSeries</span><span class="p"><span class="paren">(</span></span><span class="identifier">dataInput</span><span class="p"><span class="paren">(</span><span class="paren">)</span>,</span> <span class="identifier">theme</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">chartTheme</span><span class="p"><span class="paren">(</span></span><span class="s"><span class="string">"white"</span></span><span class="p"><span class="paren">)</span>,</span> 
    <span class="identifier">type</span> <span class="o"><span class="operator">=</span></span> <span class="s"><span class="string">"line"</span></span><span class="p">,</span> <span class="identifier">log.scale</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">log</span><span class="p">,</span> <span class="identifier">TA</span> <span class="o"><span class="operator">=</span></span> <span class="kc"><span class="literal">NULL</span></span><span class="p"><span class="paren">)</span></span>
<span class="p"><span class="paren">}</span><span class="paren">)</span></span>
</code></pre></div>

<p>Reactive expressions are a bit smarter than regular R functions. They cache their values and know when their values have become outdated. What does this mean? The first time that you run a reactive expression, the expression will save its result in your computer’s memory. The next time you call the reactive expression, it can return this saved result without doing any computation (which will make your app faster). </p>

<p>The reactive expression will only return the saved result if it knows that the result is up-to-date. If the reactive expression has learned that the result is obsolete (because a widget has changed), the expression will recalculate the result. It then returns the new result and saves a new copy. The reactive expression will use this new copy until it too becomes out of date.</p>

<p>Let’s summarize this behavior</p>

<ul>
  <li>
    <p>A reactive expression saves its result the first time you run it.</p>
  </li>
  <li>
    <p>The next time the reactive expression is called, it checks if the saved value has become out of date (i.e., whether the widgets it depends on have changed).</p>
  </li>
  <li>
    <p>If the value is out of date, the reactive object will recalculate it (and then save the new result).</p>
  </li>
  <li>
    <p>If the value is up-to-date, the reactive expression will return the saved value without doing any computation.</p>
  </li>
</ul>

<p>You can use this behavior to prevent Shiny from re-running unnecessary code. Consider how a reactive expression will work in the new stockVis app below.</p>

<div class="highlight"><pre><code class="r"><span class="c1"><span class="comment"># server.R</span></span>

<span class="keyword">library</span><span class="p"><span class="paren">(</span></span><span class="identifier">quantmod</span><span class="p"><span class="paren">)</span></span>
<span class="keyword">source</span><span class="p"><span class="paren">(</span></span><span class="s"><span class="string">"helpers.R"</span></span><span class="p"><span class="paren">)</span></span>

<span class="identifier">shinyServer</span><span class="p"><span class="paren">(</span></span><span class="kr"><span class="keyword">function</span></span><span class="p"><span class="paren">(</span></span><span class="identifier">input</span><span class="p">,</span> <span class="identifier">output</span><span class="p"><span class="paren">)</span></span> <span class="p"><span class="paren">{</span></span>

  <span class="identifier">dataInput</span> <span class="o"><span class="operator">&lt;-</span></span> <span class="identifier">reactive</span><span class="p"><span class="paren">(</span><span class="paren">{</span></span>
    <span class="identifier">getSymbols</span><span class="p"><span class="paren">(</span></span><span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">symb</span><span class="p">,</span> <span class="identifier">src</span> <span class="o"><span class="operator">=</span></span> <span class="s"><span class="string">"yahoo"</span></span><span class="p">,</span> 
      <span class="identifier">from</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">dates</span><span class="p"><span class="paren">[</span></span><span class="m"><span class="number">1</span></span><span class="p"><span class="paren">]</span>,</span>
      <span class="identifier">to</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">dates</span><span class="p"><span class="paren">[</span></span><span class="m"><span class="number">2</span></span><span class="p"><span class="paren">]</span>,</span>
      <span class="identifier">auto.assign</span> <span class="o"><span class="operator">=</span></span> <span class="kc"><span class="literal">FALSE</span></span><span class="p"><span class="paren">)</span></span>
  <span class="p"><span class="paren">}</span><span class="paren">)</span></span>

  <span class="identifier">output</span><span class="o"><span class="operator">$</span></span><span class="identifier">plot</span> <span class="o"><span class="operator">&lt;-</span></span> <span class="identifier">renderPlot</span><span class="p"><span class="paren">(</span><span class="paren">{</span></span>    
    <span class="identifier">chartSeries</span><span class="p"><span class="paren">(</span></span><span class="identifier">dataInput</span><span class="p"><span class="paren">(</span><span class="paren">)</span>,</span> <span class="identifier">theme</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">chartTheme</span><span class="p"><span class="paren">(</span></span><span class="s"><span class="string">"white"</span></span><span class="p"><span class="paren">)</span>,</span> 
      <span class="identifier">type</span> <span class="o"><span class="operator">=</span></span> <span class="s"><span class="string">"line"</span></span><span class="p">,</span> <span class="identifier">log.scale</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">log</span><span class="p">,</span> <span class="identifier">TA</span> <span class="o"><span class="operator">=</span></span> <span class="kc"><span class="literal">NULL</span></span><span class="p"><span class="paren">)</span></span>
  <span class="p"><span class="paren">}</span><span class="paren">)</span></span>
<span class="p"><span class="paren">}</span><span class="paren">)</span></span>
</code></pre></div>

<p>When you click “Plot y axis on the log scale”, <code>input$log</code> will change and <code>renderPlot</code> will re-execute. Now</p>

<ol>
  <li><code>renderPlot</code> will call <code>dataInput()</code></li>
  <li><code>dataInput</code> will check that the dates and symb widgets have not changed</li>
  <li><code>dataInput</code> will return its saved data set of stock prices <em>without re-fetching data from Yahoo</em></li>
  <li><code>renderPlot</code> will re-draw the chart with the correct axis.</li>
</ol>

<h2 id="dependencies">Dependencies</h2>

<p>What if your user changes the stock symbol in the symb widget? </p>

<p>This will make the plot drawn by <code>renderPlot</code> out of date, but <code>renderPlot</code> no longer calls <code>input$symb</code>. Will Shiny know that <code>input$symb</code> has made plot out of date? </p>

<p>Yes, Shiny will know and will redraw the plot. Shiny keeps track of which reactive expressions an <code>output</code> object depends on, as well as which widget inputs. Shiny will automatically re-build an object if</p>

<ul>
  <li>an <code>input</code> value in the objects’s <code>render*</code> function changes, or</li>
  <li>a reactive expression in the objects’s <code>render*</code> function becomes obsolete</li>
</ul>

<p>Think of reactive expressions as links in a chain that connect <code>input</code> values to <code>output</code> objects. The objects in <code>output</code> will respond to changes made anywhere downstream in the chain. (You can fashion a long chain because reactive expressions can call other reactive expressions).</p>

<p>Only call a reactive expression from within a <code>reactive</code> or a <code>render*</code>function. Why? Only these R functions are equipped to deal with reactive output, which can change without warning. In fact, Shiny will prevent you from calling reactive expressions outside of these functions.</p>

<h2 id="warm-up">Warm up</h2>

<p>Time to fix the broken check box for “Adjust prices for inflation.” Your user should be able to toggle between prices adjusted for inflation and prices that have not been adjusted.</p>

<p>The <code>adjust</code> function in <code>helpers.R</code> uses the <a href="http://research.stlouisfed.org/fred2/series/CPIAUCNS">Consumer Price Index</a> data provided by the Federal Reserve Bank of St. Louis to transform historical prices into present day values. But how can you implement this in the app?</p>

<p>Here’s one solution below, but it is not ideal. Can you spot why? Once again it has to do with <code>input$log</code>.</p>

<div class="highlight"><pre><code class="r"><span class="c1"><span class="comment"># server.R</span></span>

<span class="keyword">library</span><span class="p"><span class="paren">(</span></span><span class="identifier">quantmod</span><span class="p"><span class="paren">)</span></span>
<span class="keyword">source</span><span class="p"><span class="paren">(</span></span><span class="s"><span class="string">"helpers.R"</span></span><span class="p"><span class="paren">)</span></span>

<span class="identifier">shinyServer</span><span class="p"><span class="paren">(</span></span><span class="kr"><span class="keyword">function</span></span><span class="p"><span class="paren">(</span></span><span class="identifier">input</span><span class="p">,</span> <span class="identifier">output</span><span class="p"><span class="paren">)</span></span> <span class="p"><span class="paren">{</span></span>

  <span class="identifier">dataInput</span> <span class="o"><span class="operator">&lt;-</span></span> <span class="identifier">reactive</span><span class="p"><span class="paren">(</span><span class="paren">{</span></span>
    <span class="identifier">getSymbols</span><span class="p"><span class="paren">(</span></span><span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">symb</span><span class="p">,</span> <span class="identifier">src</span> <span class="o"><span class="operator">=</span></span> <span class="s"><span class="string">"yahoo"</span></span><span class="p">,</span> 
        <span class="identifier">from</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">dates</span><span class="p"><span class="paren">[</span></span><span class="m"><span class="number">1</span></span><span class="p"><span class="paren">]</span>,</span>
        <span class="identifier">to</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">dates</span><span class="p"><span class="paren">[</span></span><span class="m"><span class="number">2</span></span><span class="p"><span class="paren">]</span>,</span>
        <span class="identifier">auto.assign</span> <span class="o"><span class="operator">=</span></span> <span class="kc"><span class="literal">FALSE</span></span><span class="p"><span class="paren">)</span></span>
  <span class="p"><span class="paren">}</span><span class="paren">)</span></span>

  <span class="identifier">output</span><span class="o"><span class="operator">$</span></span><span class="identifier">plot</span> <span class="o"><span class="operator">&lt;-</span></span> <span class="identifier">renderPlot</span><span class="p"><span class="paren">(</span><span class="paren">{</span></span>   
    <span class="identifier">data</span> <span class="o"><span class="operator">&lt;-</span></span> <span class="identifier">dataInput</span><span class="p"><span class="paren">(</span><span class="paren">)</span></span>
    <span class="kr"><span class="keyword">if</span></span> <span class="p"><span class="paren">(</span></span><span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">adjust</span><span class="p"><span class="paren">)</span></span> <span class="identifier">data</span> <span class="o"><span class="operator">&lt;-</span></span> <span class="identifier">adjust</span><span class="p"><span class="paren">(</span></span><span class="identifier">dataInput</span><span class="p"><span class="paren">(</span><span class="paren">)</span><span class="paren">)</span></span>
    
    <span class="identifier">chartSeries</span><span class="p"><span class="paren">(</span></span><span class="identifier">data</span><span class="p">,</span> <span class="identifier">theme</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">chartTheme</span><span class="p"><span class="paren">(</span></span><span class="s"><span class="string">"white"</span></span><span class="p"><span class="paren">)</span>,</span> 
        <span class="identifier">type</span> <span class="o"><span class="operator">=</span></span> <span class="s"><span class="string">"line"</span></span><span class="p">,</span> <span class="identifier">log.scale</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">log</span><span class="p">,</span> <span class="identifier">TA</span> <span class="o"><span class="operator">=</span></span> <span class="kc"><span class="literal">NULL</span></span><span class="p"><span class="paren">)</span></span>
  <span class="p"><span class="paren">}</span><span class="paren">)</span></span>
<span class="p"><span class="paren">}</span><span class="paren">)</span></span>
</code></pre></div>

<div class="answer"><a class="btn btn-default answer-toggle" href="http://shiny.rstudio.com/tutorial/lesson6/#">Reveal answer</a><div class="answer-content">
<p><code>adjust</code> is called <em>inside</em> <code>renderPlot</code>. If the adjust box is checked, the app will readjust all of the prices each time you switch from a normal y scale to a logged y scale. This readjustment is unnecessary work.</p>

</div></div>

<h2 id="your-turn">Your Turn</h2>

<p>Fix this problem by adding a new reactive expression to the app. The reactive expression should take the value of <code>dataInput</code> and return an adjusted (or not adjusted) copy of the data. </p>

<p>When you think you have it, compare your solution to the model answer below. Make sure you understand what calculations will happen and what calculations will not happen in your app when your user clicks “Plot y axis on the log scale”.</p>

<div class="answer"><a class="btn btn-default answer-toggle" href="http://shiny.rstudio.com/tutorial/lesson6/#">Reveal answer</a><div class="answer-content">
<div class="highlight"><pre><code class="r"><span class="c1"><span class="comment"># server.R</span></span>

<span class="keyword">library</span><span class="p"><span class="paren">(</span></span><span class="identifier">quantmod</span><span class="p"><span class="paren">)</span></span>
<span class="keyword">source</span><span class="p"><span class="paren">(</span></span><span class="s"><span class="string">"helpers.R"</span></span><span class="p"><span class="paren">)</span></span>


<span class="identifier">shinyServer</span><span class="p"><span class="paren">(</span></span><span class="kr"><span class="keyword">function</span></span><span class="p"><span class="paren">(</span></span><span class="identifier">input</span><span class="p">,</span> <span class="identifier">output</span><span class="p"><span class="paren">)</span></span> <span class="p"><span class="paren">{</span></span>
  
  <span class="identifier">dataInput</span> <span class="o"><span class="operator">&lt;-</span></span> <span class="identifier">reactive</span><span class="p"><span class="paren">(</span><span class="paren">{</span></span>  
      <span class="identifier">getSymbols</span><span class="p"><span class="paren">(</span></span><span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">symb</span><span class="p">,</span> <span class="identifier">src</span> <span class="o"><span class="operator">=</span></span> <span class="s"><span class="string">"yahoo"</span></span><span class="p">,</span> 
          <span class="identifier">from</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">dates</span><span class="p"><span class="paren">[</span></span><span class="m"><span class="number">1</span></span><span class="p"><span class="paren">]</span>,</span>
          <span class="identifier">to</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">dates</span><span class="p"><span class="paren">[</span></span><span class="m"><span class="number">2</span></span><span class="p"><span class="paren">]</span>,</span>
          <span class="identifier">auto.assign</span> <span class="o"><span class="operator">=</span></span> <span class="kc"><span class="literal">FALSE</span></span><span class="p"><span class="paren">)</span></span>
  <span class="p"><span class="paren">}</span><span class="paren">)</span></span>
  
  <span class="identifier">finalInput</span> <span class="o"><span class="operator">&lt;-</span></span> <span class="identifier">reactive</span><span class="p"><span class="paren">(</span><span class="paren">{</span></span>
    <span class="kr"><span class="keyword">if</span></span> <span class="p"><span class="paren">(</span></span><span class="o"><span class="operator">!</span></span><span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">adjust</span><span class="p"><span class="paren">)</span></span> <span class="kr"><span class="keyword">return</span></span><span class="p"><span class="paren">(</span></span><span class="identifier">dataInput</span><span class="p"><span class="paren">(</span><span class="paren">)</span><span class="paren">)</span></span>
    <span class="identifier">adjust</span><span class="p"><span class="paren">(</span></span><span class="identifier">dataInput</span><span class="p"><span class="paren">(</span><span class="paren">)</span><span class="paren">)</span></span>
  <span class="p"><span class="paren">}</span><span class="paren">)</span></span>
  
  <span class="identifier">output</span><span class="o"><span class="operator">$</span></span><span class="identifier">plot</span> <span class="o"><span class="operator">&lt;-</span></span> <span class="identifier">renderPlot</span><span class="p"><span class="paren">(</span><span class="paren">{</span></span>
    <span class="identifier">chartSeries</span><span class="p"><span class="paren">(</span></span><span class="identifier">finalInput</span><span class="p"><span class="paren">(</span><span class="paren">)</span>,</span> <span class="identifier">theme</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">chartTheme</span><span class="p"><span class="paren">(</span></span><span class="s"><span class="string">"white"</span></span><span class="p"><span class="paren">)</span>,</span> 
        <span class="identifier">type</span> <span class="o"><span class="operator">=</span></span> <span class="s"><span class="string">"line"</span></span><span class="p">,</span> <span class="identifier">log.scale</span> <span class="o"><span class="operator">=</span></span> <span class="identifier">input</span><span class="o"><span class="operator">$</span></span><span class="identifier">log</span><span class="p">,</span> <span class="identifier">TA</span> <span class="o"><span class="operator">=</span></span> <span class="kc"><span class="literal">NULL</span></span><span class="p"><span class="paren">)</span></span>
  <span class="p"><span class="paren">}</span><span class="paren">)</span></span>
<span class="p"><span class="paren">}</span><span class="paren">)</span></span>
</code></pre></div>

<p>Now you have isolated each input in its own reactive expression or <code>render*</code> function. If an input changes, only out of date expressions will re-run.</p>

<p>Here’s an example of the flow:</p>

<ul>
  <li>A user clicks “Plot y axis on the log scale.”</li>
  <li><code>renderPlot</code> re-runs.</li>
  <li><code>renderPlot</code> calls <code>finalInput</code>.</li>
  <li><code>finalInput</code> checks with <code>dataInput</code> and <code>input$adjust</code>.</li>
  <li>If neither has changed, <code>finalInput</code> returns its saved value.</li>
  <li>If either has changed, <code>finalInput</code> calculates a new value with the current inputs. It will pass the new value to <code>renderPlot</code> and store the new value for future queries.</li>
</ul>

</div></div>

<h2 id="recap">Recap</h2>

<p>You can make your apps faster by modularizing your code with reactive expressions. </p>

<ul>
  <li>A reactive expression takes <code>input</code> values, or values from other reactive expressions, and returns a new value</li>
  <li>Reactive expressions save their results, and will only re-calculate if their input has changed</li>
  <li>Create reactive expressions with <code>reactive({ })</code></li>
  <li>Call reactive expressions with the name of the expression followed by parentheses <code>()</code></li>
  <li>Only call reactive expressions from within other reactive expressions or <code>render*</code> functions</li>
</ul>

<p>You can now create sophisticated, streamlined Shiny apps. The final lesson in this tutorial will show you how to share your apps with others.</p>


  
    <p>
      <a class="btn btn-primary" href="http://shiny.rstudio.com/tutorial/lesson7">
        Continue to lesson 7
      </a>
    </p>
  
    <br>
  <hr>
  <p>Let us know what you think! If you have a sophisticated question, or want an in depth answer, please post at the <a href="https://groups.google.com/forum/#!forum/shiny-discuss">Shiny Discussion Forum</a>, where we can respond at length. For help with code, check out <a href="http://shiny.rstudio.com/articles/help.html">How to get help</a>.</p>

<div id="disqus_thread"><iframe id="dsq-2" data-disqus-uid="2" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Shiny - Use reactive expressions_files/saved_resource.html" style="width: 100% !important; border: none !important; overflow: hidden !important; height: 8545px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe><iframe id="dsq-indicator-north" data-disqus-uid="indicator-north" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" style="width: 637px !important; border: none !important; overflow: hidden !important; top: 0px !important; min-width: 637px !important; max-width: 637px !important; position: fixed !important; z-index: 2147483646 !important; height: 29px !important; min-height: 29px !important; max-height: 29px !important; display: none !important;"></iframe><iframe id="dsq-indicator-south" data-disqus-uid="indicator-south" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" style="width: 637px !important; border: none !important; overflow: hidden !important; bottom: 0px !important; min-width: 637px !important; max-width: 637px !important; position: fixed !important; z-index: 2147483646 !important; height: 29px !important; min-height: 29px !important; max-height: 29px !important; display: none !important;"></iframe></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'shiny-rstudio'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the &lt;a href="http://disqus.com/?ref_noscript"&gt;comments powered by Disqus.&lt;/a&gt;</noscript>

</div>

  </div>
</div>
<div class="footer">
  <div class="footer-inner">
    Shiny is an <a href="http://www.rstudio.com/">RStudio</a> project.
    © 2014 RStudio, Inc.
  </div>
</div>

<script type="text/javascript">
document.write(unescape("%3Cscript src='//munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="http://munchkin.marketo.net/munchkin.js" type="text/javascript"></script>
<script>Munchkin.init('709-NXN-706');</script>



<div id="st-main-container" style="display: none;">
  <div class="swiftype">
  <a class="close" data-dismiss="st-modal" href="http://shiny.rstudio.com/tutorial/lesson6/#">×</a>
  <div class="st-search-bar st-only-input">
    <form>
      <div class="st-input-wrapper">
        <div class="st-input-inner">
          <input type="text" value="" id="st-overlay-search-input" placeholder="search this website" autocomplete="off" autocorrect="off" autocapitalize="off" style="outline: none;">
          <span class="st-input-icon"></span>
          <a href="https://swiftype.com/?ref=pbo" class="st-input-powered-by st-powered-by" target="_blank"></a>
        </div>
        <input type="submit" value="search" id="submitbutton">
      </div>
    </form>
  </div>
  <div class="st-result-wrapper" style="min-height: 612px;">
    <div class="st-result-listing">
      <div class="st-results">
      </div>
      <div class="st-indexing-notice" style="display: none;">
        This site is still being indexed. Please try your search again in a few minutes.
      </div>
      <div class="st-logo-footer st-powered-by">
        <a href="http://swiftype.com/?ref=pbo" target="_blank">search by swiftype</a>
      </div>
    </div>
  </div>
</div>
</div><div class="swiftype-widget"><div class="autocomplete" style="position: absolute; z-index: 199999; width: 210px; top: 0px; left: -8px; display: none;"><ul></ul></div></div><div class="swiftype-widget"><div class="autocomplete" style="position: absolute; z-index: 199999; width: 210px; top: 40px; left: 1035.57153320313px; display: none;"><ul></ul></div></div></body></html>